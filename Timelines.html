<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Civilization Timeline</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            height: 8px;
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #475569;
        }

        .dark ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        body {
            overscroll-behavior-x: none;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useLayoutEffect, useEffect, useMemo } = React;

        // --- ICONS (Inline SVGs to replace Lucide imports) ---
        const IconWrapper = ({ children, size = 24, className = "" }) => (
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width={size}
                height={size}
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                strokeWidth="2"
                strokeLinecap="round"
                strokeLinejoin="round"
                className={className}
            >
                {children}
            </svg>
        );

        const ZoomIn = (props) => <IconWrapper {...props}><circle cx="11" cy="11" r="8" /><line x1="21" y1="21" x2="16.65" y2="16.65" /><line x1="11" y1="8" x2="11" y2="14" /><line x1="8" y1="11" x2="14" y2="11" /></IconWrapper>;
        const ZoomOut = (props) => <IconWrapper {...props}><circle cx="11" cy="11" r="8" /><line x1="21" y1="21" x2="16.65" y2="16.65" /><line x1="8" y1="11" x2="14" y2="11" /></IconWrapper>;
        const RefreshCcw = (props) => <IconWrapper {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" /><path d="M3 3v5h5" /></IconWrapper>;
        const MousePointer2 = (props) => <IconWrapper {...props}><path d="m12 6 4 6-2.29 2.29 4.29 4.29-1.41 1.41-4.29-4.29-2.29 2.29Z" /></IconWrapper>;
        const Cpu = (props) => <IconWrapper {...props}><rect x="4" y="4" width="16" height="16" rx="2" /><rect x="9" y="9" width="6" height="6" /><path d="M9 1v3" /><path d="M15 1v3" /><path d="M9 20v3" /><path d="M15 20v3" /><path d="M20 9h3" /><path d="M20 14h3" /><path d="M1 9h3" /><path d="M1 14h3" /></IconWrapper>;
        const Landmark = (props) => <IconWrapper {...props}><line x1="3" y1="22" x2="21" y2="22" /><line x1="6" y1="18" x2="6" y2="11" /><line x1="10" y1="18" x2="10" y2="11" /><line x1="14" y1="18" x2="14" y2="11" /><line x1="18" y1="18" x2="18" y2="11" /><polygon points="12 2 20 7 4 7" /></IconWrapper>;
        const Layers = (props) => <IconWrapper {...props}><polygon points="12 2 2 7 12 12 22 7 12 2" /><polyline points="2 17 12 22 22 17" /><polyline points="2 12 12 17 22 12" /></IconWrapper>;
        const Split = (props) => <IconWrapper {...props}><path d="M16 3h5v5" /><path d="M8 3H3v5" /><path d="M12 22v-8.3a4 4 0 0 0-1.172-2.872L3 3" /><path d="m15 9 6-6" /></IconWrapper>;
        const Moon = (props) => <IconWrapper {...props}><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z" /></IconWrapper>;
        const Sun = (props) => <IconWrapper {...props}><circle cx="12" cy="12" r="4" /><path d="M12 2v2" /><path d="M12 20v2" /><path d="m4.93 4.93 1.41 1.41" /><path d="m17.66 17.66 1.41 1.41" /><path d="M2 12h2" /><path d="M20 12h2" /><path d="m6.34 17.66-1.41 1.41" /><path d="m19.07 4.93-1.41 1.41" /></IconWrapper>;

        // --- DATASETS ---

        const TECH_ERAS = [
            { name: "Stone Age", start: -10000, end: -3300, color: "stone", description: "Early stone tools, agriculture, and permanent settlements." },
            { name: "Bronze Age", start: -3300, end: -1200, color: "orange", description: "Bronze, early writing, and first urban civilizations." },
            { name: "Iron Age", start: -1200, end: 500, color: "slate", description: "Iron tools, classical antiquity, and empires." },
            { name: "Middle Ages", start: 500, end: 1400, color: "violet", description: "Post-classical history, feudalism, and slow technological accumulation." },
            { name: "Renaissance", start: 1400, end: 1750, color: "pink", description: "Rebirth of science, art, printing press, and exploration." },
            { name: "Industrial Rev.", start: 1750, end: 1950, color: "rose", description: "Mass production, steam, electricity, and mechanization." },
            { name: "Information Age", start: 1950, end: 2010, color: "sky", description: "Computers, internet, and globalization." },
            { name: "AI Era", start: 2010, end: 2035, color: "emerald", description: "Artificial intelligence, robotics, and autonomous systems." }
        ];

        const INVENTIONS = [
            { year: -10000, name: "Agriculture", icon: "ðŸŒ¾" },
            { year: -9000, name: "Animal Domestication", icon: "ðŸ•" },
            { year: -6000, name: "Pottery", icon: "ðŸº" },
            { year: -5000, name: "Irrigation", icon: "ðŸ’§" },
            { year: -4000, name: "Sailing Boats", icon: "â›µ" },
            { year: -3500, name: "The Wheel", icon: "â˜¸ï¸" },
            { year: -3200, name: "Writing (Cuneiform)", icon: "âœï¸" },
            { year: -3000, name: "Bronze Tools", icon: "âš”ï¸" },
            { year: -2500, name: "Papyrus", icon: "ðŸ“œ" },
            { year: -2500, name: "Glass Making", icon: "ðŸ¥ƒ" },
            { year: -2000, name: "Chariot", icon: "ðŸŽ" },
            { year: -1500, name: "Alphabet", icon: "ðŸ”¤" },
            { year: -1200, name: "Iron Smelting", icon: "ðŸ”¨" },
            { year: -600, name: "Coins", icon: "ðŸ’°" },
            { year: -500, name: "Crane (Lifting)", icon: "ðŸ—ï¸" },
            { year: -200, name: "Paper (China)", icon: "ðŸ“„" },
            { year: -100, name: "Concrete (Roman)", icon: "ðŸ›ï¸" },
            { year: 105, name: "Modern Paper", icon: "ðŸ“" },
            { year: 850, name: "Gunpowder", icon: "ðŸ§¨" },
            { year: 900, name: "Windmills", icon: "ðŸŒ¬ï¸" },
            { year: 1040, name: "Movable Type", icon: "ðŸ”¡" },
            { year: 1100, name: "Magnetic Compass", icon: "ðŸ§­" },
            { year: 1280, name: "Eyeglasses", icon: "ðŸ‘“" },
            { year: 1300, name: "Mechanical Clock", icon: "ðŸ•°ï¸" },
            { year: 1440, name: "Printing Press", icon: "ðŸ–¨ï¸" },
            { year: 1590, name: "Microscope", icon: "ðŸ”¬" },
            { year: 1608, name: "Telescope", icon: "ðŸ”­" },
            { year: 1642, name: "Adding Machine", icon: "âž•" },
            { year: 1712, name: "Steam Engine", icon: "ðŸš‚" },
            { year: 1752, name: "Lightning Rod", icon: "âš¡" },
            { year: 1764, name: "Spinning Jenny", icon: "ðŸ§µ" },
            { year: 1796, name: "Vaccination", icon: "ðŸ’‰" },
            { year: 1800, name: "Electric Battery", icon: "ðŸ”‹" },
            { year: 1804, name: "Steam Locomotive", icon: "ðŸš†" },
            { year: 1826, name: "Photography", icon: "ðŸ“·" },
            { year: 1837, name: "Telegraph", icon: "ðŸ“ " },
            { year: 1844, name: "Anesthesia", icon: "ðŸ˜·" },
            { year: 1860, name: "Internal Combustion", icon: "â›½" },
            { year: 1876, name: "Telephone", icon: "â˜Žï¸" },
            { year: 1879, name: "Light Bulb", icon: "ðŸ’¡" },
            { year: 1885, name: "Automobile", icon: "ðŸš—" },
            { year: 1895, name: "X-Rays", icon: "ðŸ¦´" },
            { year: 1895, name: "Radio", icon: "ðŸ“»" },
            { year: 1903, name: "Airplane", icon: "âœˆï¸" },
            { year: 1907, name: "Plastics (Bakelite)", icon: "ðŸ¥¤" },
            { year: 1926, name: "Liquid Rocket", icon: "ðŸš€" },
            { year: 1927, name: "Television", icon: "ðŸ“º" },
            { year: 1928, name: "Penicillin", icon: "ðŸ’Š" },
            { year: 1937, name: "Jet Engine", icon: "ðŸ›«" },
            { year: 1942, name: "Nuclear Reactor", icon: "â˜¢ï¸" },
            { year: 1947, name: "Transistor", icon: "ðŸ“»" },
            { year: 1953, name: "DNA Structure", icon: "ðŸ§¬" },
            { year: 1957, name: "Sputnik (Satellite)", icon: "ðŸ›°ï¸" },
            { year: 1958, name: "Integrated Circuit", icon: "ðŸ’¾" },
            { year: 1960, name: "Laser", icon: "ðŸ”¦" },
            { year: 1969, name: "Internet (ARPANET)", icon: "ðŸŒ" },
            { year: 1969, name: "Moon Landing", icon: "ðŸŒ•" },
            { year: 1971, name: "Microprocessor", icon: "ðŸ’»" },
            { year: 1974, name: "Personal Computer", icon: "ðŸ–¥ï¸" },
            { year: 1983, name: "Mobile Phone", icon: "ðŸ“±" },
            { year: 1990, name: "World Wide Web", icon: "ðŸŒ" },
            { year: 1996, name: "Cloning (Dolly)", icon: "ðŸ‘" },
            { year: 2004, name: "Social Media", icon: "ðŸ‘" },
            { year: 2007, name: "Smartphone", icon: "ðŸ¤³" },
            { year: 2009, name: "Blockchain", icon: "â›“ï¸" },
            { year: 2012, name: "CRISPR/Cas9", icon: "âœ‚ï¸" },
            { year: 2015, name: "Reusable Rockets", icon: "ðŸš€" },
            { year: 2020, name: "mRNA Vaccines", icon: "ðŸ’‰" },
            { year: 2022, name: "Generative AI", icon: "ðŸ¤–" },
            { year: 2024, name: "Commercial Fusion (Exp)", icon: "â˜€ï¸" }
        ];

        const POL_ERAS = [
            { name: "Pre-State / Bands", start: -10000, end: -3500, color: "stone", description: "Small, kin-based, egalitarian hunter-gatherer bands and early tribes." },
            { name: "Ancient Empires", start: -3500, end: 500, color: "orange", description: "Rise of city-states, god-kings, and the first vast territorial empires." },
            { name: "Medieval / Feudal", start: 500, end: 1500, color: "violet", description: "Decentralized feudalism, religious authority, and dynastic kingdoms." },
            { name: "Early Modern", start: 1500, end: 1789, color: "pink", description: "Absolutism, emergence of sovereignty, and the Westphalian nation-state." },
            { name: "Age of Revolution", start: 1789, end: 1945, color: "rose", description: "Spread of democracy, nationalism, fascism, and communism." },
            { name: "Global Era", start: 1945, end: 2035, color: "sky", description: "Internationalism, supranational unions, and modern statecraft." }
        ];

        const POLITICAL_SYSTEMS = [
            { name: "Band Societies", start: -10000, end: -3000, type: "Tribal", icon: "ðŸ¹", description: "Small, egalitarian, kin-based groups. No formal leadership." },
            { name: "Tribes & Chiefdoms", start: -8000, end: -1000, type: "Tribal", icon: "â›º", description: "Larger groups with centralized leadership but no bureaucracy." },
            { name: "City-States (Sumerian)", start: -3500, end: -2000, type: "City-State", icon: "ðŸ™ï¸", description: "Independent sovereign cities with surrounding territory (e.g., Uruk)." },
            { name: "God-King Theocracy", start: -3100, end: -1070, type: "Monarchy", icon: "ðŸ‘ï¸", description: "Rulers viewed as living gods or divine intermediaries (e.g., Old Kingdom Egypt)." },
            { name: "Territorial Empires", start: -2334, end: -330, type: "Empire", icon: "ðŸ¦…", description: "Centralized rule over diverse peoples (e.g., Akkadian, Persian)." },
            { name: "Classical Republics", start: -509, end: -27, type: "Republic", icon: "ðŸ›ï¸", description: "Public affair governance with some representation (e.g., Roman Republic)." },
            { name: "Direct Democracy", start: -508, end: -322, type: "Democracy", icon: "ðŸ—³ï¸", description: "Citizens vote directly on legislation (e.g., Athens)." },
            { name: "Imperial Bureaucracy", start: -221, end: 1911, type: "Empire", icon: "ðŸ“œ", description: "Meritocratic or centralized civil service rule (e.g., Imperial China)." },
            { name: "Feudalism", start: 800, end: 1500, type: "Feudal", icon: "ðŸ°", description: "Hierarchy of land ownership and service duties." },
            { name: "Merchant Republics", start: 1000, end: 1797, type: "Republic", icon: "âš–ï¸", description: "Oligarchic city-states run by merchant families (e.g., Venice)." },
            { name: "Absolute Monarchy", start: 1450, end: 1789, type: "Monarchy", icon: "ðŸ‘‘", description: "Monarch holds supreme autocratic authority." },
            { name: "Westphalian Nation-State", start: 1648, end: 2035, type: "State", icon: "ðŸš©", description: "Sovereignty based on territorial borders and non-interference." },
            { name: "Constitutional Monarchy", start: 1688, end: 2035, type: "Mixed", icon: "ðŸ¤´", description: "Monarch acts as head of state within parameters of a constitution." },
            { name: "Liberal Democracy", start: 1776, end: 2035, type: "Democracy", icon: "ðŸ—½", description: "Representative democracy protecting individual liberty." },
            { name: "Federalism", start: 1787, end: 2035, type: "System", icon: "ðŸ¤", description: "Power divided between central authority and constituent units." },
            { name: "Fascism", start: 1922, end: 1945, type: "Authoritarian", icon: "ðŸ¦…", description: "Far-right, authoritarian ultranationalism." },
            { name: "Communism (State)", start: 1917, end: 1991, type: "Authoritarian", icon: "â˜­", description: "Single-party state planning aimed at common ownership." },
            { name: "Welfare State", start: 1945, end: 2035, type: "System", icon: "ðŸ¥", description: "State plays key role in protection of economic and social well-being." },
            { name: "Supranational Unions", start: 1952, end: 2035, type: "Global", icon: "ðŸ‡ªðŸ‡º", description: "Member states delegate power to a central authority (e.g., EU)." }
        ];

        // --- HELPERS ---

        const formatYear = (year) => {
            if (year < 0) return `${Math.abs(Math.floor(year))} BCE`;
            return `${Math.floor(year)} CE`;
        };

        // Specific Hex Codes for Vibrancy (Restored)
        const hexColors = {
            stone: "#e5e7eb",   // Gray 200
            orange: "#fdba74",  // Orange 300
            slate: "#94a3b8",   // Slate 400
            violet: "#a78bfa",  // Violet 400
            pink: "#f472b6",    // Pink 400
            rose: "#fb7185",    // Rose 400
            sky: "#38bdf8",     // Sky 400
            emerald: "#34d399"  // Emerald 400
        };

        // Political bar colors
        const polColors = {
            'Tribal': '#a8a29e',
            'City-State': '#f59e0b',
            'Empire': '#b91c1c',
            'Monarchy': '#7c3aed',
            'Republic': '#0ea5e9',
            'Feudal': '#8b5cf6',
            'Democracy': '#10b981',
            'State': '#3b82f6',
            'Authoritarian': '#57534e',
            'Mixed': '#ec4899',
            'System': '#0891b2',
            'Global': '#6366f1'
        };

        const layoutPoliticalLanes = (systems) => {
            const lanes = [];
            const sortedSystems = [...systems].sort((a, b) => a.start - b.start);
            return sortedSystems.map(sys => {
                let laneIndex = lanes.findIndex(laneEndTime => laneEndTime < sys.start - 50);
                if (laneIndex === -1) {
                    lanes.push(sys.end);
                    laneIndex = lanes.length - 1;
                } else {
                    lanes[laneIndex] = Math.max(lanes[laneIndex], sys.end);
                }
                return { ...sys, lane: laneIndex };
            });
        };

        function TimelineApp() {
            // Modes: 'tech' | 'pol' | 'merged-overlap' | 'merged-split'
            const [mode, setMode] = useState('tech');
            const [zoom, setZoom] = useState(1);
            const [isDarkMode, setIsDarkMode] = useState(false);
            const [hoveredItem, setHoveredItem] = useState(null);
            const [cursorYear, setCursorYear] = useState(null);
            const [mousePos, setMousePos] = useState({ x: 0, y: 0 });

            const containerRef = useRef(null);
            const nextScrollLeft = useRef(null);
            const layoutPolData = useMemo(() => layoutPoliticalLanes(POLITICAL_SYSTEMS), []);

            // --- CONFIGURATION CONSTANTS ---
            const startYear = -10000;
            const endYear = 2035;
            const totalYears = endYear - startYear;
            const PADDING_LEFT = 50;
            const TIMELINE_HEIGHT = 900;
            const timelineWidth = totalYears * zoom;

            // Dynamic layout properties based on mode
            const layout = useMemo(() => {
                const isSplit = mode === 'merged-split';
                const isOverlap = mode === 'merged-overlap';
                const centerY = TIMELINE_HEIGHT / 2;

                // Shifted down by ~40px to allow room for era labels at the top
                return {
                    techAxisY: isSplit ? TIMELINE_HEIGHT * 0.65 : (isOverlap ? centerY + 20 : 290),
                    polAxisY: isSplit ? TIMELINE_HEIGHT * 0.35 : (isOverlap ? centerY + 20 : 240),
                    polDirection: isSplit ? -1 : (isOverlap ? -1 : 1), // -1 means bars grow/stack upwards
                    techDirection: 1, // 1 means labels drop downwards
                    showTech: mode === 'tech' || isOverlap || isSplit,
                    showPol: mode === 'pol' || isOverlap || isSplit,
                    eraSet: mode === 'pol' ? POL_ERAS : TECH_ERAS
                };
            }, [mode]);

            // --- EFFECTS ---
            useEffect(() => {
                if (containerRef.current) {
                    const modernStart = 1700;
                    const pixelsToModern = (modernStart - startYear) * zoom;
                    containerRef.current.scrollLeft = pixelsToModern - containerRef.current.clientWidth / 2;
                }
            }, []);

            useLayoutEffect(() => {
                if (nextScrollLeft.current !== null && containerRef.current) {
                    containerRef.current.scrollLeft = nextScrollLeft.current;
                    nextScrollLeft.current = null;
                }
            });

            // --- EVENT HANDLERS ---
            const handleZoom = (newZoom, centerRatio = 0.5) => {
                const safeZoom = Math.max(0.05, Math.min(newZoom, 100));
                if (containerRef.current) {
                    const container = containerRef.current;
                    const currentScroll = container.scrollLeft;
                    const containerWidth = container.clientWidth;
                    const viewportOffset = containerWidth * centerRatio;
                    const totalOffset = currentScroll + viewportOffset;
                    const yearAtCenter = (totalOffset - PADDING_LEFT) / zoom;
                    const newTotalOffset = yearAtCenter * safeZoom + PADDING_LEFT;
                    nextScrollLeft.current = newTotalOffset - viewportOffset;
                }
                setZoom(safeZoom);
            };

            const handleWheel = (e) => {
                if (e.altKey) {
                    e.preventDefault();
                    const direction = e.deltaY > 0 ? 0.9 : 1.1;
                    const rect = containerRef.current.getBoundingClientRect();
                    const mouseX = e.clientX - rect.left;
                    const ratio = mouseX / rect.width;
                    handleZoom(zoom * direction, ratio);
                }
            };

            const handleMouseMove = (e) => {
                if (!containerRef.current) return;
                const rect = containerRef.current.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const scrollLeft = containerRef.current.scrollLeft;
                const totalX = x + scrollLeft;
                const year = (totalX - PADDING_LEFT) / zoom + startYear;
                setCursorYear(year);
                setMousePos({ x: e.clientX, y: e.clientY });
            };

            const handleMouseLeave = () => {
                setCursorYear(null);
            };

            // --- RENDER HELPERS ---
            const yearToX = (year) => (year - startYear) * zoom + PADDING_LEFT;

            const getTechLabelY = (index) => {
                const base = layout.techAxisY + 50; // Push down slightly for connector lines
                const step = 25;
                const levels = 12;
                return base + (index % levels) * step;
            };

            const getPolBarY = (lane) => {
                const laneHeight = 30;
                if (layout.polDirection === -1) {
                    return layout.polAxisY - 50 - (lane * laneHeight);
                }
                return layout.polAxisY + 40 + (lane * laneHeight);
            };

            // --- COMPONENT UI ---
            const theme = isDarkMode ? {
                bg: 'bg-slate-900',
                panel: 'bg-slate-800 border-slate-700',
                text: 'text-slate-100',
                subText: 'text-slate-400',
                axis: '#94a3b8',
                grid: '#1e293b',
                gridText: '#64748b',
                hoverBg: 'bg-slate-700',
                shadow: 'shadow-black/50'
            } : {
                bg: 'bg-slate-50',
                panel: 'bg-white border-slate-200',
                text: 'text-slate-900',
                subText: 'text-slate-500',
                axis: '#334155',
                grid: '#e2e8f0',
                gridText: '#94a3b8',
                hoverBg: 'bg-slate-100',
                shadow: 'shadow-xl'
            };

            return (
                <div className={`flex flex-col h-screen ${theme.bg} font-sans transition-colors duration-300 overflow-hidden select-none`}>

                    {/* HEADER */}
                    <div className={`flex-none p-4 border-b ${theme.panel} shadow-sm z-20 flex flex-col xl:flex-row justify-between items-center gap-4`}>
                        <div className="flex flex-wrap justify-center items-center gap-4">
                            <div className={`flex ${isDarkMode ? 'bg-slate-900' : 'bg-slate-100'} p-1 rounded-lg border ${isDarkMode ? 'border-slate-700' : 'border-slate-200'}`}>
                                <button onClick={() => setMode('tech')} className={`flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-semibold transition-all ${mode === 'tech' ? `${theme.panel} shadow ${theme.text}` : `${theme.subText} hover:${theme.text}`}`}>
                                    <Cpu size={16} /> Tech
                                </button>
                                <button onClick={() => setMode('pol')} className={`flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-semibold transition-all ${mode === 'pol' ? `${theme.panel} shadow ${theme.text}` : `${theme.subText} hover:${theme.text}`}`}>
                                    <Landmark size={16} /> Politics
                                </button>
                                <div className={`w-px h-5 mx-1 self-center ${isDarkMode ? 'bg-slate-700' : 'bg-slate-300'}`}></div>
                                <button onClick={() => setMode('merged-overlap')} className={`flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-semibold transition-all ${mode === 'merged-overlap' ? `${theme.panel} shadow text-purple-500` : `${theme.subText} hover:${theme.text}`}`}>
                                    <Layers size={16} /> Unified
                                </button>
                                <button onClick={() => setMode('merged-split')} className={`flex items-center gap-2 px-3 py-1.5 rounded-md text-sm font-semibold transition-all ${mode === 'merged-split' ? `${theme.panel} shadow text-purple-500` : `${theme.subText} hover:${theme.text}`}`}>
                                    <Split size={16} /> Split
                                </button>
                            </div>

                            <h1 className={`text-xl font-bold ${theme.text} hidden xl:block`}>
                                {mode === 'tech' && 'Innovation Timeline'}
                                {mode === 'pol' && 'Political Evolution'}
                                {mode.includes('merged') && 'Civilization Timeline'}
                            </h1>
                        </div>

                        <div className="flex items-center gap-4">
                            <button
                                onClick={() => setIsDarkMode(!isDarkMode)}
                                className={`p-2 rounded-full transition-colors ${theme.subText} hover:${theme.text} hover:${theme.hoverBg}`}
                            >
                                {isDarkMode ? <Sun size={20} /> : <Moon size={20} />}
                            </button>

                            <div className={`hidden md:flex items-center gap-2 text-xs ${theme.subText}`}>
                                <MousePointer2 size={12} />
                                <span>Hold <span className={`font-bold ${theme.text} px-1 rounded border ${isDarkMode ? 'border-slate-600 bg-slate-800' : 'border-slate-300 bg-slate-100'}`}>Alt</span> + Scroll</span>
                            </div>

                            <div className={`flex items-center gap-2 ${theme.panel} p-1.5 rounded-lg border shadow-sm`}>
                                <button onClick={() => handleZoom(zoom * 0.8)} className={`p-2 rounded-md ${theme.subText} hover:${theme.hoverBg}`}><ZoomOut size={18} /></button>
                                <span className={`w-12 text-center font-mono text-xs ${theme.subText}`}>{(zoom * 100).toFixed(0)}%</span>
                                <button onClick={() => handleZoom(zoom * 1.2)} className={`p-2 rounded-md ${theme.subText} hover:${theme.hoverBg}`}><ZoomIn size={18} /></button>
                                <div className={`w-px h-5 mx-1 ${isDarkMode ? 'bg-slate-700' : 'bg-slate-200'}`}></div>
                                <button
                                    onClick={() => {
                                        setZoom(1);
                                        if (containerRef.current) {
                                            const modernStart = 1800;
                                            nextScrollLeft.current = (modernStart - startYear) * 1 + PADDING_LEFT - containerRef.current.clientWidth / 2;
                                        }
                                    }}
                                    className={`p-2 rounded-md ${theme.subText} hover:${theme.hoverBg}`}
                                >
                                    <RefreshCcw size={16} />
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* MAIN CANVAS */}
                    <div
                        className="flex-1 overflow-x-auto overflow-y-hidden relative cursor-crosshair active:cursor-grabbing"
                        ref={containerRef}
                        onWheel={handleWheel}
                        onMouseMove={handleMouseMove}
                        onMouseLeave={handleMouseLeave}
                    >
                        <div
                            style={{ width: `${timelineWidth + 1000}px`, height: '100%' }}
                            className="relative"
                        >
                            <svg width={timelineWidth + 1000} height={TIMELINE_HEIGHT} className="absolute top-0 left-0 block">

                                {/* 1. GRID & ERAS */}
                                {/* Grid Lines */}
                                {Array.from({ length: Math.ceil(totalYears / (zoom < 0.5 ? 2000 : zoom < 5 ? 500 : 50)) }).map((_, i) => {
                                    const step = zoom < 0.5 ? 2000 : zoom < 5 ? 500 : 50;
                                    const year = startYear + i * step;
                                    const x = yearToX(year);
                                    if (x < 0) return null;
                                    return (
                                        <g key={year}>
                                            <line x1={x} y1={0} x2={x} y2={TIMELINE_HEIGHT} stroke={theme.grid} strokeWidth={1} strokeDasharray="4 4" />
                                            <text x={x + 5} y={layout.techAxisY + 15} fontSize={10} fill={theme.gridText} fontFamily="monospace" opacity={0.7}>{formatYear(year)}</text>
                                            {mode === 'merged-split' && (
                                                <text x={x + 5} y={layout.polAxisY - 10} fontSize={10} fill={theme.gridText} fontFamily="monospace" opacity={0.7}>{formatYear(year)}</text>
                                            )}
                                        </g>
                                    );
                                })}

                                {/* Era Backgrounds */}
                                {layout.eraSet.map((era, index) => {
                                    const startX = yearToX(era.start);
                                    const endX = yearToX(era.end);
                                    const width = endX - startX;
                                    const colorHex = hexColors[era.color];
                                    // Shifted down to y=80 to give room for labels
                                    const ERA_Y = 80;

                                    return (
                                        <g key={era.name}>
                                            {/* Background Rect (Non-interactive) */}
                                            <rect
                                                x={startX}
                                                y={ERA_Y}
                                                width={Math.max(width, 1)}
                                                height={TIMELINE_HEIGHT - ERA_Y}
                                                fill={colorHex}
                                                fillOpacity={isDarkMode ? 0.15 : 0.3}
                                            />
                                            <line x1={endX} y1={0} x2={endX} y2={TIMELINE_HEIGHT} stroke={theme.grid} strokeWidth={1} strokeOpacity={0.5} />

                                            {/* Era Label "Chip" - Interactive */}
                                            {width > 60 ? (
                                                <foreignObject x={startX} y={ERA_Y + 10} width={width} height={40} style={{ overflow: 'visible' }}>
                                                    <div className="flex justify-center">
                                                        <div
                                                            className={`
                                        px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider shadow-sm border border-black/10
                                        cursor-help transition-transform hover:scale-105 hover:z-20
                                        ${isDarkMode ? 'text-slate-100' : 'text-slate-800'}
                                        `}
                                                            style={{
                                                                backgroundColor: isDarkMode ? colorHex + '60' : colorHex, // Add transparency in dark mode
                                                                boxShadow: `0 2px 4px ${colorHex}60`
                                                            }}
                                                            onMouseEnter={(e) => setHoveredItem({ type: 'era', data: era, x: e.clientX, y: e.clientY })}
                                                            onMouseLeave={() => setHoveredItem(null)}
                                                        >
                                                            {era.name}
                                                        </div>
                                                    </div>
                                                </foreignObject>
                                            ) : (
                                                /* Rotated Label for small eras - Positioned above the era rect */
                                                <g transform={`translate(${startX + width / 2}, ${ERA_Y - 5})`}>
                                                    <text
                                                        transform="rotate(-45)"
                                                        textAnchor="start"
                                                        fontSize={10}
                                                        fontWeight="bold"
                                                        fill={isDarkMode ? '#cbd5e1' : '#475569'}
                                                        className="cursor-help uppercase tracking-wider"
                                                        onMouseEnter={(e) => setHoveredItem({ type: 'era', data: era, x: e.clientX, y: e.clientY })}
                                                        onMouseLeave={() => setHoveredItem(null)}
                                                    >
                                                        {era.name}
                                                    </text>
                                                </g>
                                            )}
                                        </g>
                                    );
                                })}


                                {/* 2. POLITICAL LAYER */}
                                {layout.showPol && (
                                    <g>
                                        <line x1={PADDING_LEFT} y1={layout.polAxisY} x2={yearToX(endYear)} y2={layout.polAxisY} stroke={theme.axis} strokeWidth={2} />
                                        {mode.includes('merged') && (
                                            <text x={PADDING_LEFT} y={layout.polAxisY - 10} fill={theme.axis} fontWeight="bold" fontSize={12}>POLITICAL</text>
                                        )}

                                        {layoutPolData.map((sys, index) => {
                                            const startX = yearToX(sys.start);
                                            const endX = yearToX(sys.end);
                                            const width = Math.max(endX - startX, 2);
                                            const y = getPolBarY(sys.lane);
                                            const color = polColors[sys.type] || '#64748b';
                                            const fillOpacity = isDarkMode ? 0.3 : 0.2;

                                            return (
                                                <g
                                                    key={`${sys.name}-${index}`}
                                                    className="cursor-pointer group"
                                                    onMouseEnter={(e) => {
                                                        const rect = e.target.getBoundingClientRect();
                                                        setHoveredItem({ type: 'pol', data: sys, x: rect.left + rect.width / 2, y: rect.top, width: width });
                                                    }}
                                                    onMouseLeave={() => setHoveredItem(null)}
                                                >
                                                    <rect
                                                        x={startX} y={y} width={width} height={24} rx={4}
                                                        fill={color} fillOpacity={fillOpacity} stroke={color} strokeWidth={1}
                                                        className="hover:fill-opacity-50 transition-all"
                                                    />
                                                    <line
                                                        x1={startX} y1={layout.polDirection === -1 ? y + 24 : y}
                                                        x2={startX} y2={layout.polAxisY}
                                                        stroke={color} strokeWidth={1} strokeDasharray="2 2" opacity={0.3}
                                                    />
                                                    <foreignObject x={startX} y={y} width={width} height={24} style={{ pointerEvents: 'none' }}>
                                                        <div className={`w-full h-full flex items-center justify-center overflow-hidden ${isDarkMode ? 'text-slate-200' : 'text-slate-800'}`} style={{ textShadow: isDarkMode ? '0 1px 2px black' : '0 1px 2px white' }}>
                                                            {/* Always show icon. If width is small, just icon. If large, icon + text */}
                                                            <span className="flex-shrink-0 text-sm mr-1">{sys.icon}</span>
                                                            {width > 60 && (
                                                                <span className="text-[11px] font-semibold truncate">{sys.name}</span>
                                                            )}
                                                        </div>
                                                    </foreignObject>
                                                </g>
                                            );
                                        })}
                                    </g>
                                )}


                                {/* 3. TECH LAYER */}
                                {layout.showTech && (
                                    <g>
                                        <line x1={PADDING_LEFT} y1={layout.techAxisY} x2={yearToX(endYear)} y2={layout.techAxisY} stroke={theme.axis} strokeWidth={2} />
                                        {mode.includes('merged') && (
                                            <text x={PADDING_LEFT} y={layout.techAxisY + 20} fill={theme.axis} fontWeight="bold" fontSize={12}>TECHNOLOGY</text>
                                        )}

                                        {INVENTIONS.map((inv, index) => {
                                            const x = yearToX(inv.year);
                                            const yEnd = getTechLabelY(index);

                                            return (
                                                <g
                                                    key={`${inv.name}-${index}`}
                                                    className="group"
                                                    onMouseEnter={(e) => {
                                                        const rect = e.target.getBoundingClientRect();
                                                        setHoveredItem({ type: 'tech', data: inv, x: rect.left, y: rect.top });
                                                    }}
                                                    onMouseLeave={() => setHoveredItem(null)}
                                                >
                                                    {/* Simpler line style */}
                                                    <path d={`M ${x} ${layout.techAxisY} L ${x} ${yEnd}`} stroke={theme.gridText} strokeWidth={1} />
                                                    <circle cx={x} cy={layout.techAxisY} r={3} fill={theme.axis} className="group-hover:fill-blue-500 transition-colors" />

                                                    {/* Floating pill cards */}
                                                    <foreignObject x={x - 75} y={yEnd} width={150} height={60} style={{ overflow: 'visible', pointerEvents: 'none' }}>
                                                        <div className={`flex flex-col items-center text-center transition-transform duration-200 group-hover:scale-110 group-hover:z-50 relative`}>
                                                            <div className={`${theme.panel} border shadow-sm px-2 py-1 rounded text-xs font-medium ${theme.text} whitespace-nowrap group-hover:bg-slate-800 group-hover:text-white group-hover:border-slate-800 pointer-events-auto cursor-default flex items-center gap-1`}>
                                                                <span>{inv.icon}</span>
                                                                {inv.name}
                                                            </div>
                                                            {zoom > 0.5 && (
                                                                <div className="text-[10px] font-mono mt-0.5 opacity-60 text-center bg-white/50 dark:bg-black/50 px-1 rounded">
                                                                    {formatYear(inv.year)}
                                                                </div>
                                                            )}
                                                        </div>
                                                    </foreignObject>
                                                </g>
                                            );
                                        })}
                                    </g>
                                )}

                            </svg>
                        </div>
                    </div>

                    {/* OVERLAYS */}
                    {cursorYear !== null && (
                        <div
                            className="fixed pointer-events-none z-50 px-2 py-1 rounded bg-blue-600 text-white text-xs font-bold shadow-md transform -translate-x-1/2 -translate-y-full mb-2"
                            style={{ left: mousePos.x, top: mousePos.y - 10 }}
                        >
                            {formatYear(cursorYear)}
                        </div>
                    )}

                    {hoveredItem && (
                        <div
                            className={`fixed z-50 p-4 rounded-xl border shadow-2xl backdrop-blur-md animate-in fade-in zoom-in-95 duration-150 max-w-xs pointer-events-none
                        ${isDarkMode ? 'bg-slate-800/95 border-slate-600 text-slate-100' : 'bg-white/95 border-slate-200 text-slate-800'}
                    `}
                            style={{
                                left: hoveredItem.x,
                                top: hoveredItem.y + (hoveredItem.type === 'pol' ? 30 : -10),
                                transform: 'translate(-50%, -100%)'
                            }}
                        >
                            {hoveredItem.type === 'era' && (
                                <>
                                    <div className="text-xs font-bold uppercase tracking-wider opacity-50 mb-1">Historical Era</div>
                                    <h3 className="font-bold text-lg mb-1">{hoveredItem.data.name}</h3>
                                    <div className="font-mono text-xs opacity-70 mb-2">{formatYear(hoveredItem.data.start)} â€” {formatYear(hoveredItem.data.end)}</div>
                                    <p className="text-sm opacity-90">{hoveredItem.data.description}</p>
                                </>
                            )}
                            {hoveredItem.type === 'pol' && (
                                <>
                                    <div className="text-xs font-bold uppercase tracking-wider opacity-50 mb-1">Political System</div>
                                    <h3 className="font-bold text-lg mb-1" style={{ color: polColors[hoveredItem.data.type] }}>
                                        <span className="mr-2">{hoveredItem.data.icon}</span>
                                        {hoveredItem.data.name}
                                    </h3>
                                    <div className="font-mono text-xs opacity-70 mb-2">{formatYear(hoveredItem.data.start)} â€” {hoveredItem.data.end > 2024 ? 'Present' : formatYear(hoveredItem.data.end)}</div>
                                    <p className="text-sm opacity-90">{hoveredItem.data.description}</p>
                                    <div className="mt-2 text-[10px] px-1.5 py-0.5 rounded bg-slate-200 dark:bg-slate-700 inline-block font-mono">Type: {hoveredItem.data.type}</div>
                                </>
                            )}
                            {hoveredItem.type === 'tech' && (
                                <>
                                    <div className="text-xs font-bold uppercase tracking-wider opacity-50 mb-1">Innovation</div>
                                    <h3 className="font-bold text-lg mb-1 text-blue-500">
                                        <span className="mr-2">{hoveredItem.data.icon}</span>
                                        {hoveredItem.data.name}
                                    </h3>
                                    <div className="font-mono text-xs opacity-70 mb-2">{formatYear(hoveredItem.data.year)}</div>
                                </>
                            )}
                        </div>
                    )}

                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<TimelineApp />);
    </script>
</body>

</html>